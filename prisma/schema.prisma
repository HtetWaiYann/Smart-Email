generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  image     String? // Google profile image if available
  createdAt DateTime @default(now())

  accounts OAuthAccount[]
  emails   Email[]
}

model OAuthAccount {
  id           String   @id @default(cuid())
  userId       String
  provider     String // only "google" for now
  accessToken  String
  refreshToken String
  expiresAt    DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Email {
  id     String @id @default(cuid())
  userId String

  // Gmail identifiers
  gmailId  String @unique
  threadId String

  // Basic metadata
  from       String
  subject    String
  snippet    String
  receivedAt DateTime

  // AI-generated fields (via MCP)
  category       EmailCategory
  urgency        Int
  summary        String
  suggestedReply String?

  // User actions
  isDone     Boolean   @default(false)
  archivedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category, urgency])
}

enum EmailCategory {
  ACTION
  MEETING
  INFO
  NOISE
}

